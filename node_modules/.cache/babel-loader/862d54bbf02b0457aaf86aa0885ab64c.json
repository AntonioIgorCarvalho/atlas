{"ast":null,"code":"var _jsxFileName = \"/home/leosilvagomes/Documentos/mit/br-dashboard/src/components/Map/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { useState, useRef, useEffect } from \"react\";\nimport mapboxgl from \"mapbox-gl\"; //@ts-ignore\n\nimport geojsonURL from \"../../data/SP-districts-geojson.json\";\nimport { formatPopulationNumber } from \"../../utils/population\";\nimport \"./styles.css\";\nimport * as turf from \"@turf/turf\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Map = () => {\n  _s();\n\n  const [map, setMap] = useState();\n  const mapContainer = useRef();\n  useEffect(() => {\n    mapboxgl.accessToken = \"pk.eyJ1IjoibGVvc2lsdmFnb21lcyIsImEiOiJja2MwdmxhZjAwejdsMnlsbXFsYTV5ZmVsIn0.MyyvEV2SHjCbCkIUeL_9bA\";\n    const hoveredPopup = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false,\n      className: \"floating-popup\"\n    });\n\n    const initializeMap = ({\n      mapContainer\n    }) => {\n      var hoveredId;\n      var clickedId;\n      const map = new mapboxgl.Map({\n        container: mapContainer.current,\n        style: \"mapbox://styles/mapbox/dark-v10\",\n        // style: \"mapbox://styles/leosilvagomes/cku2qu4ks2mgz17r100gt7rq6/draft\",\n        center: [-46.7, -23.68],\n        zoom: 9.2\n      });\n\n      const clickFeature = feature => {\n        if (feature && feature.geometry) {}\n      };\n\n      const highlightFeature = feature => {\n        if (feature && feature.geometry) {\n          if (feature.properties.FEATID === hoveredId) {\n            return;\n          }\n\n          var coordinates = turf.centerOfMass(feature).geometry.coordinates;\n          var regionName = feature.properties.NAME_DIST;\n          var regionPersonsNum = formatPopulationNumber(feature.properties.PERSONS_NUM);\n          hoveredPopup.setLngLat([coordinates[0], coordinates[1]]).setHTML(`<h5>${regionName} - ${regionPersonsNum}</h5>`).addTo(map);\n          map.setFeatureState({\n            source: \"sp\",\n            id: feature.properties.FEATID\n          }, {\n            hover: true\n          });\n          map.setFeatureState({\n            source: \"sp\",\n            id: hoveredId\n          }, {\n            hover: false\n          });\n          hoveredId = feature.properties.FEATID;\n        } else {\n          hoveredPopup.remove();\n          map.setFeatureState({\n            source: \"sp\",\n            id: hoveredId\n          }, {\n            hover: false\n          });\n          hoveredId = 0;\n        }\n      };\n\n      const clearFeatureHighlight = () => {\n        highlightFeature(null);\n      };\n\n      map.on(\"load\", () => {\n        map.dragRotate.disable();\n        map.touchZoomRotate.disableRotation();\n        map.addSource(\"sp\", {\n          type: \"geojson\",\n          //@ts-ignore\n          data: geojsonURL,\n          promoteId: \"FEATID\"\n        });\n        map.addLayer({\n          id: \"fill-sp\",\n          type: \"fill\",\n          source: \"sp\",\n          paint: {\n            \"fill-color\": {\n              property: \"PERSONS_NUM\",\n              stops: [[0, \"#ADDC91\"], [55000, \"#6CC24A\"], [110000, \"#509E2F\"], [215000, \"#4A7729\"]]\n            },\n            \"fill-opacity\": [\"case\", [\"boolean\", [\"feature-state\", \"click\"], false], 1, [\"boolean\", [\"feature-state\", \"highlight\"], false], 1, [\"boolean\", [\"feature-state\", \"hover\"], false], 1, 0.8]\n          }\n        });\n        map.addLayer({\n          id: \"sp-borders\",\n          type: \"line\",\n          source: \"sp\",\n          paint: {\n            \"line-color\": \"#ffffff\",\n            \"line-width\": [\"case\", [\"boolean\", [\"feature-state\", \"click\"], false], 1.8, [\"boolean\", [\"feature-state\", \"highlight\"], false], 1.8, [\"boolean\", [\"feature-state\", \"hover\"], false], 1.8, 0.75],\n            \"line-opacity\": [\"case\", [\"boolean\", [\"feature-state\", \"click\"], false], 1.5, [\"boolean\", [\"feature-state\", \"highlight\"], false], 1.5, [\"boolean\", [\"feature-state\", \"hover\"], false], 1.5, 0.5]\n          }\n        });\n      });\n      map.on(\"mousemove\", \"fill-sp\", e => {\n        if (e.features.length > 0) {\n          highlightFeature(e.features[0]);\n        }\n      });\n      map.on(\"mouseleave\", \"fill-sp\", clearFeatureHighlight);\n      map.on(\"mouseleave\", \"click\", e => {\n        if (e.features.length > 0) {\n          highlightFeature(e.features[0]);\n        }\n      });\n      setMap(map);\n    };\n\n    console.log(map);\n    if (!map) initializeMap({\n      mapContainer\n    });\n  }, [map]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: \"map\",\n    ref: el => mapContainer.current = el,\n    className: \"map\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 175,\n    columnNumber: 10\n  }, this);\n};\n\n_s(Map, \"o/5gB3J1lzJ5EQZDqT+A6WQSsyY=\");\n\n_c = Map;\n\nvar _c;\n\n$RefreshReg$(_c, \"Map\");","map":{"version":3,"sources":["/home/leosilvagomes/Documentos/mit/br-dashboard/src/components/Map/index.tsx"],"names":["useState","useRef","useEffect","mapboxgl","geojsonURL","formatPopulationNumber","turf","Map","map","setMap","mapContainer","accessToken","hoveredPopup","Popup","closeButton","closeOnClick","className","initializeMap","hoveredId","clickedId","container","current","style","center","zoom","clickFeature","feature","geometry","highlightFeature","properties","FEATID","coordinates","centerOfMass","regionName","NAME_DIST","regionPersonsNum","PERSONS_NUM","setLngLat","setHTML","addTo","setFeatureState","source","id","hover","remove","clearFeatureHighlight","on","dragRotate","disable","touchZoomRotate","disableRotation","addSource","type","data","promoteId","addLayer","paint","property","stops","e","features","length","console","log","el"],"mappings":";;;AAAA,SAASA,QAAT,EAAmBC,MAAnB,EAA2BC,SAA3B,QAA4C,OAA5C;AACA,OAAOC,QAAP,MAAqB,WAArB,C,CACA;;AACA,OAAOC,UAAP,MAAuB,sCAAvB;AACA,SAASC,sBAAT,QAAuC,wBAAvC;AACA,OAAO,cAAP;AACA,OAAO,KAAKC,IAAZ,MAAsB,YAAtB;;AAEA,OAAO,MAAMC,GAAG,GAAG,MAAM;AAAA;;AACvB,QAAM,CAACC,GAAD,EAAMC,MAAN,IAAgBT,QAAQ,EAA9B;AACA,QAAMU,YAAY,GAAGT,MAAM,EAA3B;AAEAC,EAAAA,SAAS,CAAC,MAAM;AACdC,IAAAA,QAAQ,CAACQ,WAAT,GACE,mGADF;AAGA,UAAMC,YAAY,GAAG,IAAIT,QAAQ,CAACU,KAAb,CAAmB;AACtCC,MAAAA,WAAW,EAAE,KADyB;AAEtCC,MAAAA,YAAY,EAAE,KAFwB;AAGtCC,MAAAA,SAAS,EAAE;AAH2B,KAAnB,CAArB;;AAMA,UAAMC,aAAa,GAAG,CAAC;AAACP,MAAAA;AAAD,KAAD,KAAyB;AAC7C,UAAIQ,SAAJ;AACA,UAAIC,SAAJ;AAEA,YAAMX,GAAG,GAAG,IAAIL,QAAQ,CAACI,GAAb,CAAiB;AAC3Ba,QAAAA,SAAS,EAAEV,YAAY,CAACW,OADG;AAE3BC,QAAAA,KAAK,EAAE,iCAFoB;AAG3B;AACAC,QAAAA,MAAM,EAAE,CAAC,CAAC,IAAF,EAAO,CAAC,KAAR,CAJmB;AAK3BC,QAAAA,IAAI,EAAE;AALqB,OAAjB,CAAZ;;AAQA,YAAMC,YAAY,GAAIC,OAAD,IAAmB;AAEtC,YAAIA,OAAO,IAAIA,OAAO,CAACC,QAAvB,EAAiC,CAChC;AAEF,OALD;;AAOA,YAAMC,gBAAgB,GAAIF,OAAD,IAAmB;AAE1C,YAAIA,OAAO,IAAIA,OAAO,CAACC,QAAvB,EAAiC;AAE/B,cAAGD,OAAO,CAACG,UAAR,CAAmBC,MAAnB,KAA8BZ,SAAjC,EAA4C;AAC1C;AACD;;AAED,cAAIa,WAAW,GAAGzB,IAAI,CAAC0B,YAAL,CAAkBN,OAAlB,EAA2BC,QAA3B,CAAoCI,WAAtD;AACA,cAAIE,UAAU,GAAGP,OAAO,CAACG,UAAR,CAAmBK,SAApC;AACA,cAAIC,gBAAgB,GAAG9B,sBAAsB,CAACqB,OAAO,CAACG,UAAR,CAAmBO,WAApB,CAA7C;AACAxB,UAAAA,YAAY,CACTyB,SADH,CACa,CAACN,WAAW,CAAC,CAAD,CAAZ,EAAiBA,WAAW,CAAC,CAAD,CAA5B,CADb,EAEGO,OAFH,CAEY,OAAML,UAAW,MAAKE,gBAAiB,OAFnD,EAGGI,KAHH,CAGS/B,GAHT;AAKAA,UAAAA,GAAG,CAACgC,eAAJ,CACE;AAAEC,YAAAA,MAAM,EAAE,IAAV;AAAgBC,YAAAA,EAAE,EAAEhB,OAAO,CAACG,UAAR,CAAmBC;AAAvC,WADF,EAEE;AAAEa,YAAAA,KAAK,EAAE;AAAT,WAFF;AAKAnC,UAAAA,GAAG,CAACgC,eAAJ,CACE;AAAEC,YAAAA,MAAM,EAAE,IAAV;AAAgBC,YAAAA,EAAE,EAAExB;AAApB,WADF,EAEE;AAAEyB,YAAAA,KAAK,EAAE;AAAT,WAFF;AAKAzB,UAAAA,SAAS,GAAGQ,OAAO,CAACG,UAAR,CAAmBC,MAA/B;AACD,SAzBD,MAyBO;AACLlB,UAAAA,YAAY,CAACgC,MAAb;AACApC,UAAAA,GAAG,CAACgC,eAAJ,CACE;AAAEC,YAAAA,MAAM,EAAE,IAAV;AAAgBC,YAAAA,EAAE,EAAExB;AAApB,WADF,EAEE;AAAEyB,YAAAA,KAAK,EAAE;AAAT,WAFF;AAIAzB,UAAAA,SAAS,GAAG,CAAZ;AACD;AACF,OAnCD;;AAqCA,YAAM2B,qBAAqB,GAAG,MAAM;AAClCjB,QAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACD,OAFD;;AAIApB,MAAAA,GAAG,CAACsC,EAAJ,CAAO,MAAP,EAAe,MAAM;AACnBtC,QAAAA,GAAG,CAACuC,UAAJ,CAAeC,OAAf;AACAxC,QAAAA,GAAG,CAACyC,eAAJ,CAAoBC,eAApB;AAEA1C,QAAAA,GAAG,CAAC2C,SAAJ,CAAc,IAAd,EAAoB;AAClBC,UAAAA,IAAI,EAAE,SADY;AAElB;AACAC,UAAAA,IAAI,EAAEjD,UAHY;AAIlBkD,UAAAA,SAAS,EAAE;AAJO,SAApB;AAQA9C,QAAAA,GAAG,CAAC+C,QAAJ,CAAa;AACXb,UAAAA,EAAE,EAAE,SADO;AAEXU,UAAAA,IAAI,EAAE,MAFK;AAGXX,UAAAA,MAAM,EAAE,IAHG;AAIXe,UAAAA,KAAK,EAAE;AACL,0BACA;AACEC,cAAAA,QAAQ,EAAE,aADZ;AAEEC,cAAAA,KAAK,EAAE,CACL,CAAC,CAAD,EAAI,SAAJ,CADK,EAEL,CAAC,KAAD,EAAQ,SAAR,CAFK,EAGL,CAAC,MAAD,EAAS,SAAT,CAHK,EAIL,CAAC,MAAD,EAAS,SAAT,CAJK;AAFT,aAFK;AAWL,4BAAgB,CACd,MADc,EAEd,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,OAAlB,CAAZ,EAAwC,KAAxC,CAFc,EAGd,CAHc,EAId,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,WAAlB,CAAZ,EAA4C,KAA5C,CAJc,EAKd,CALc,EAMd,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,OAAlB,CAAZ,EAAwC,KAAxC,CANc,EAOd,CAPc,EAQd,GARc;AAXX;AAJI,SAAb;AA4BAlD,QAAAA,GAAG,CAAC+C,QAAJ,CAAa;AACXb,UAAAA,EAAE,EAAE,YADO;AAEXU,UAAAA,IAAI,EAAE,MAFK;AAGXX,UAAAA,MAAM,EAAE,IAHG;AAIXe,UAAAA,KAAK,EAAE;AACL,0BAAc,SADT;AAEL,0BAAc,CACZ,MADY,EAEZ,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,OAAlB,CAAZ,EAAwC,KAAxC,CAFY,EAGZ,GAHY,EAIZ,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,WAAlB,CAAZ,EAA4C,KAA5C,CAJY,EAKZ,GALY,EAMZ,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,OAAlB,CAAZ,EAAwC,KAAxC,CANY,EAOZ,GAPY,EAQZ,IARY,CAFT;AAYL,4BAAgB,CACd,MADc,EAEd,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,OAAlB,CAAZ,EAAwC,KAAxC,CAFc,EAGd,GAHc,EAId,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,WAAlB,CAAZ,EAA4C,KAA5C,CAJc,EAKd,GALc,EAMd,CAAC,SAAD,EAAY,CAAC,eAAD,EAAkB,OAAlB,CAAZ,EAAwC,KAAxC,CANc,EAOd,GAPc,EAQd,GARc;AAZX;AAJI,SAAb;AA4BD,OApED;AAuEAhD,MAAAA,GAAG,CAACsC,EAAJ,CAAO,WAAP,EAAoB,SAApB,EAAgCa,CAAD,IAAY;AACzC,YAAIA,CAAC,CAACC,QAAF,CAAWC,MAAX,GAAoB,CAAxB,EAA2B;AACzBjC,UAAAA,gBAAgB,CAAC+B,CAAC,CAACC,QAAF,CAAW,CAAX,CAAD,CAAhB;AACD;AACF,OAJD;AAMApD,MAAAA,GAAG,CAACsC,EAAJ,CAAO,YAAP,EAAqB,SAArB,EAAgCD,qBAAhC;AAEArC,MAAAA,GAAG,CAACsC,EAAJ,CAAO,YAAP,EAAqB,OAArB,EAA+Ba,CAAD,IAAY;AACxC,YAAIA,CAAC,CAACC,QAAF,CAAWC,MAAX,GAAoB,CAAxB,EAA2B;AACzBjC,UAAAA,gBAAgB,CAAC+B,CAAC,CAACC,QAAF,CAAW,CAAX,CAAD,CAAhB;AACD;AACF,OAJD;AAMAnD,MAAAA,MAAM,CAACD,GAAD,CAAN;AACD,KAlJD;;AAoJAsD,IAAAA,OAAO,CAACC,GAAR,CAAYvD,GAAZ;AACA,QAAI,CAACA,GAAL,EAAUS,aAAa,CAAC;AAACP,MAAAA;AAAD,KAAD,CAAb;AACX,GAhKQ,EAgKN,CAACF,GAAD,CAhKM,CAAT;AAkKA,sBAAO;AAAK,IAAA,EAAE,EAAC,KAAR;AAAc,IAAA,GAAG,EAAGwD,EAAD,IAAStD,YAAY,CAACW,OAAb,GAAuB2C,EAAnD;AAAwD,IAAA,SAAS,EAAC;AAAlE;AAAA;AAAA;AAAA;AAAA,UAAP;AACD,CAvKM;;GAAMzD,G;;KAAAA,G","sourcesContent":["import { useState, useRef, useEffect } from \"react\";\nimport mapboxgl from \"mapbox-gl\";\n//@ts-ignore\nimport geojsonURL from \"../../data/SP-districts-geojson.json\";\nimport { formatPopulationNumber } from \"../../utils/population\"\nimport \"./styles.css\"\nimport * as turf from \"@turf/turf\";\n\nexport const Map = () => {\n  const [map, setMap] = useState<mapboxgl.Map>();\n  const mapContainer = useRef<any>();\n  \n  useEffect(() => {\n    mapboxgl.accessToken =\n      \"pk.eyJ1IjoibGVvc2lsdmFnb21lcyIsImEiOiJja2MwdmxhZjAwejdsMnlsbXFsYTV5ZmVsIn0.MyyvEV2SHjCbCkIUeL_9bA\";\n    \n    const hoveredPopup = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false,\n      className: \"floating-popup\",\n    });\n    \n    const initializeMap = ({mapContainer}: any) => {\n      var hoveredId : number\n      var clickedId : number\n      \n      const map = new mapboxgl.Map({\n        container: mapContainer.current,\n        style: \"mapbox://styles/mapbox/dark-v10\",\n        // style: \"mapbox://styles/leosilvagomes/cku2qu4ks2mgz17r100gt7rq6/draft\",\n        center: [-46.7,-23.68],\n        zoom: 9.2,\n      });\n\n      const clickFeature = (feature : any) => { \n        \n        if (feature && feature.geometry) {\n        }\n\n      }\n\n      const highlightFeature = (feature : any) => { \n        \n        if (feature && feature.geometry) {\n          \n          if(feature.properties.FEATID === hoveredId) {\n            return;\n          }\n\n          var coordinates = turf.centerOfMass(feature).geometry.coordinates;\n          var regionName = feature.properties.NAME_DIST;\n          var regionPersonsNum = formatPopulationNumber(feature.properties.PERSONS_NUM);\n          hoveredPopup\n            .setLngLat([coordinates[0], coordinates[1]])\n            .setHTML(`<h5>${regionName} - ${regionPersonsNum}</h5>`)\n            .addTo(map);\n\n          map.setFeatureState(\n            { source: \"sp\", id: feature.properties.FEATID },\n            { hover: true }\n          );\n\n          map.setFeatureState(\n            { source: \"sp\", id: hoveredId },\n            { hover: false }\n          );\n\n          hoveredId = feature.properties.FEATID\n        } else {\n          hoveredPopup.remove();\n          map.setFeatureState(\n            { source: \"sp\", id: hoveredId },\n            { hover: false }\n          );\n          hoveredId = 0\n        }\n      }\n\n      const clearFeatureHighlight = () => {\n        highlightFeature(null);\n      }\n\n      map.on(\"load\", () => {\n        map.dragRotate.disable();\n        map.touchZoomRotate.disableRotation();\n\n        map.addSource(\"sp\", {\n          type: \"geojson\",\n          //@ts-ignore\n          data: geojsonURL,\n          promoteId: \"FEATID\",\n        });\n\n\n        map.addLayer({\n          id: \"fill-sp\",\n          type: \"fill\",\n          source: \"sp\",\n          paint: {\n            \"fill-color\":\n            {\n              property: \"PERSONS_NUM\",\n              stops: [\n                [0, \"#ADDC91\"],\n                [55000, \"#6CC24A\"],\n                [110000, \"#509E2F\"],\n                [215000, \"#4A7729\"],\n              ],\n            },\n            \"fill-opacity\": [\n              \"case\",\n              [\"boolean\", [\"feature-state\", \"click\"], false],\n              1,\n              [\"boolean\", [\"feature-state\", \"highlight\"], false],\n              1,\n              [\"boolean\", [\"feature-state\", \"hover\"], false],\n              1,\n              0.8,\n            ],\n          },\n        });\n\n        map.addLayer({\n          id: \"sp-borders\",\n          type: \"line\",\n          source: \"sp\",\n          paint: {\n            \"line-color\": \"#ffffff\",\n            \"line-width\": [\n              \"case\",\n              [\"boolean\", [\"feature-state\", \"click\"], false],\n              1.8,\n              [\"boolean\", [\"feature-state\", \"highlight\"], false],\n              1.8,\n              [\"boolean\", [\"feature-state\", \"hover\"], false],\n              1.8,\n              0.75,\n            ],\n            \"line-opacity\": [\n              \"case\",\n              [\"boolean\", [\"feature-state\", \"click\"], false],\n              1.5,\n              [\"boolean\", [\"feature-state\", \"highlight\"], false],\n              1.5,\n              [\"boolean\", [\"feature-state\", \"hover\"], false],\n              1.5,\n              0.5,\n            ],\n          },\n        });\n      });\n\n\n      map.on(\"mousemove\", \"fill-sp\", (e: any) => {\n        if (e.features.length > 0) {\n          highlightFeature(e.features[0]);\n        }\n      });\n\n      map.on(\"mouseleave\", \"fill-sp\", clearFeatureHighlight);\n\n      map.on(\"mouseleave\", \"click\", (e: any) => {\n        if (e.features.length > 0) {\n          highlightFeature(e.features[0]);\n        }\n      });\n\n      setMap(map)\n    };\n\n    console.log(map)\n    if (!map) initializeMap({mapContainer});\n  }, [map]);\n\n  return <div id=\"map\" ref={(el) => (mapContainer.current = el)} className=\"map\" />;\n};\n"]},"metadata":{},"sourceType":"module"}